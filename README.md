DoubanSpider
============
##目的：

  抓取所有电影信息

##运行方法：
  
  1. npm install
  2. npm install forever -g
  3. 配置
  4. sh spider.sh seed      #抓取种子网址
     sh spider.sh spider    #开启爬虫   ，此处启动，依赖forever
     sh spider.sh analyse   #开启网页分析
     
##数据库配置：
  
  两个mongo db，一个用来暂时存储抓取的网页，一个用来存储结构话数据。

  两个redis  set， 一个用来存储待抓取电影编号，一个存储所有抓取过的电影编号。
  
##爬虫策略：
  
  抓取数据与分析数据分开。
  
  抓取时，从redis_target 中取得电影编号，验证是否在redis_history中，如果未曾抓取，则downLoad
  把抓取的网页写入mongodb。 
  
  为了解决403问题，可在机器上配置多块网卡，通过配置文件进行配置，另外可配置每块网卡每分钟抓取次数。
  由于抓取程序的瓶颈在io,所以以单进程运行，但可以配置进程中请求并发数。
    
  网页分析进程用于形成结构化数据和产生新的待抓取网址，计算量较大，采用master-slaver，主从多进程模式。
    
另：

  爬虫运行参数，热配置，包括爬虫的并发数、抓取频率、子进程数。即 configure.json中control 的子属性。
  
##目录结构：

  src/applications.js  核心功能函数 下载和分析
  
  src/context.js       上下文，包括日志和数据库配置
  
  src/db.js            mongo redis的驱动调用
  
  src/index.js         analyse父进程
  
  src/pageAnalyse.js   网页分析类
  
  src/seed.js          种子抓取脚本
  
  src/speedControl.js  抓取频率控制类
  
  src/spider.js        爬虫策略
  
  src/startAnalyse.js  网页分析子进程
  
  src/startSpider.js   启动爬虫进程
  
##运结果
  
结构化数据如下：
{

	"_id" : 1292281,

		"title" : "迁徙的鸟 Le peuple migrateur",

		"time" : 2001,
		"baseInfo" : {
			"导演" : [
				"雅克·贝汉",
			"雅克·克鲁奥德",
			"Michel Debats"
				],
			"编剧" : [
				"Francis Roux",
			"雅克·贝汉",
			"Stéphane Durand",
			"Jean Dorst",
			"Guy Jarry"
				],
			"主演" : [
				"Philippe Labro",
			"雅克·贝汉"
				],
			"类型" : [
				"纪录片"
				],
			"制片国家/地区" : [
				"法国",
			"德国",
			"意大利",
			"西班牙",
			"瑞士 Switzerland"
				],
			"语言" : [
				"法语",
			"英语"
				],
			"上映日期" : [
				"2001-12-12(法国)"
				],
			"片长" : [
				"98分钟(法国)",
			"81分钟(多伦多电影节)",
			"89分钟(美国)",
			"92分钟(阿根廷)"
				],
			"又名" : [
				"鸟的迁徙",
			"鸟与梦飞行",
			"鹏程千万里",
			"迁徙的候鸟",
			"我是一只季候鸟",
			"天地人三部曲之迁徙的鸟",
			"The Travelling Birds",
			"Winged Migration"
				],
			"IMDb链接" : [
				"tt0301727"
				]
		},
		"scoreInfo" : {
			"score" : 9.1,
			"people" : 38963,
			"percent" : [
				"63.6%",
			"29.4%",
			"6.5%",
			"0.3%",
			"0.1%"
				]
		},
		"intro" : "当鸟儿用羽翼去实现梦想，翱翔在我们永远无法凭借自身企及的天空，人类又该赋予他们怎样的赞叹呢？\n                                        \n                                    　　“鸟的迁徙是一个关于承诺的故事，一种对于回归的承诺。”雅克·贝汉以这样一句话带我们踏上了鸟与梦飞行之旅。毫无疑问，[迁徙的鸟]直接界定了世界顶级纪录片“获取真实”的标准——前后共600多人参与拍摄，历时3年多、耗资4000多万美元，景地遍及全球50多个国家和地区，记录胶片长达460多公里。这部动用了17个世界上最优秀的飞行员和两个科学考察队的电影甫一出世，就引起轰动。短短三个星期内就有250多万法国人为它走进影院，飞越1200公里的大天鹅对生命的坚持，在漫天风沙中追寻出路的沙丘鹤、在冰天雪地下与海鸦对抗到底的企鹅……尽管当中也有失败气馁，也有悬崖边的木头木脑，也有来自人类贪欲的窥视。\n                                        \n                                    　　除了简单的说明，整部影片不再有言语。本片的主角是憨态可掬，形态各异的鸟。他...",
		"recommendations" : [
		{
			"title" : "BBC自然世界：鲨鱼湾的海豚",
			"id" : 5364968
		},
		{
			"title" : "与虎同行",
			"id" : 3036578
		},
		{
			"title" : "中国影星大聚会",
			"id" : 10549232
		},
		{
			"title" : "二十岁的夏天",
			"id" : 4195633
		},
		{
			"title" : "克斗马",
			"id" : 19944275
		},
		{
			"title" : "动物星球之解冻的生物",
			"id" : 5965675
		},
		{
			"title" : "北极故事",
			"id" : 2111619
		},
		{
			"title" : "唤醒绿色虎－绿色运动在中国...",
			"id" : 10618258
		},
		{
			"title" : "喜马拉雅",
			"id" : 1303017
		},
		{
			"title" : "园丁鸟的魅力艺术",
			"id" : 3143038
		}
	]
}

